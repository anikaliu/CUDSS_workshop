---
title: "CUDSS_R_Data_Vis"
author: "ls760 and Anika"
date: "12/01/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Reminder/Disclaimer

To follow the workshop you should have already a basic knowledge of R/coding. 
Fully charged laptop or charger
Have R and Rstudio installed on your laptop




```{R load libraries and import the data}

library(tidyverse) # Load the Tidyverse package. More info at https://www.tidyverse.org/

body_fat_df <- read_csv("bodyfat.csv", col_names = TRUE) # import the Body Fat Data Frame. Source: http://www-huber.embl.de/users/klaus/BasicR/bodyfat.rda

```

## Explore the data

It is a good practice to explore a bit your data before starting to work with them. It is helpful to understand what to plot ... and even if the dataset need some wrangling. 

Good functions to explore your data frame are dim(), summary(), head()

```{r basic functions}

dim(body_fat_df) # shows the row number and column number of the data frame
head(body_fat_df, 10) # head it is used to visualize the first 10 (in this case) lines of the dataframe
summary(body_fat_df) # print a short stats report of the data frame
 
# ?<function_name> (e.g. ?dim) gives some info about the function and the grammar. Also help(<function_name>) has a similar use.

```

Let's we are interested in working just with people over 40 y.o., how could we subset the dataframe?

```{r subset data frame}

body_fat_df_over_40 <- body_fat_df %>% 
                       filter(age > 40 )

# %>%  this simbol is called "pipe" is way to passing infromation from one function to the following one

body_fat_df_over_age <- body_fat_df %>% 
                       filter(age > 40 & height > 70.00)

body_fat_df_over_age_height <- body_fat_df %>% 
                       filter(age > 40 | height > 70.00)

body_fat_df_over_age_height <- body_fat_df_over_age_height %>% 
                                mutate(BMI = (weight/height^2) * 703 ) %>% # muate here is used to calculate the BMI and add it as a new column to the data frame 
                                select(age, height, weight, BMI, density, percent.fat, everything()) %>%   # re-order the data.frame columns as we want. everything() is used to call all the columns which haven't been called before
                                arrange(desc(BMI)) # this command will sort the data frame columns accordin to the descending BMI order. arrange is reframing the dataframe and desc() is asking to sort them in an descending order.

```

Now we have shaped the data frame and created new

```{r poltting}

plot_hist <- ggplot(body_fat_df_over_age_height, mapping = aes( x = percent.fat)) + # ggplot function is creating the empty graphic 
          geom_histogram() 

plot_box <- ggplot(body_fat_df_over_age_height, mapping = aes( y = percent.fat)) + # ggplot function is creating the empty graphic 
          geom_boxplot() 
# the boxplot shows the quantiles and the median of the data. The qualtiles are dividing the data in top 25% and bottom 25%, the square has 50% of the entire dataset
# with dots ahowinf the outliers. (The x axis in this case is not meaningfull) 

plot_scatter <-ggplot(body_fat_df_over_age_height, aes(BMI, percent.fat))+
                      geom_point(aes(color=age, size=density)) +
                      geom_smooth(method= "lm") 

# To calculate the coefficient and intercept you could use this formula
lm(data = body_fat_df_over_age_height, BMI ~ percent.fat)
# To calculate Pearson correlation of the variable percentage of fat to all the other
cor(body_fat_df_over_age_height, body_fat_df_over_age_height$percent.fat)

```


```{r melt}

library(reshape2)


body_fat_melt <- body_fat_df %>% 
                 melt(id.vars=c('density', 'percent.fat','age','weight','height')) # melt is using the columns you are listing to create a uniq ID which is the column name/ID, then it stacks the set of columns in a single column (more info: https://i1.wp.com/www.studytrails.com/wp-content/uploads/2016/09/reshape.png).

```

To look how you data have chanegd you can do: 
head(body_fat_df) 
dim(body_fat_df)
and compare it to:
head(body_fat_melt)
dim(body_fat_melt)

you'll see know that the variables that are the columns in the body_fat_df are observations in the dataframe body_fat_melt in the column variable. The values for the ......


```{r facet}


plot_scatter <-ggplot(body_fat_melt, aes(value, percent.fat))+
                      geom_point(aes(color=age, size=density)) +
                      geom_smooth(method= "lm") +
                      facet_wrap(~variable, scales = 'free_x')

```